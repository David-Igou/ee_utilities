---
version: 1

build_arg_defaults:
  ANSIBLE_GALAXY_CLI_COLLECTION_OPTS: "-v"
  EE_BASE_IMAGE: quay.io/podman/stable


dependencies:
  system: bindep
  python: python_req

additional_build_steps:

  append: 
    - RUN pip3 install ansible-core
    - VOLUME /var/lib/docker
    - VOLUME /runner
    - RUN for dir in \
    - /home/runner \
    - /home/runner/.ansible \
    - /home/runner/.ansible/tmp \
    - /runner \
    - /home/runner \
    - /runner/env \
    - /runner/inventory \
    - /runner/project \
    - /runner/artifacts ; \
    - do mkdir -m 0775 -p $dir ; chmod -R g+rwx $dir ; chgrp -R root $dir ; done && \
    - for file in \
    - /home/runner/.ansible/galaxy_token \
    - /etc/passwd \
    - /etc/group ; \
    - do touch $file ; chmod g+rw $file ; chgrp root $file ; done
    - ADD https://raw.githubusercontent.com/ansible/ansible-runner/devel/utils/entrypoint.sh /bin/entrypoint
    - RUN chmod +x /bin/entrypoint
